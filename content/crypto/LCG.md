---
title: "What is LCG?"
excerpt: "线性同余生成器"
date: "2025-12-13"
slug: "lcg-intro"
section: "crypto"
---

<div class="intro-article">

简单介绍一下一个在密码学和随机数生成中常见的算法

 **LCG (Linear Congruential Generator，线性同余生成器)**。

核心逻辑：基于一个简单的线性递推公式来生成伪随机序列，但参数已知时可预测！😀

---

##  第一步：理解递推公式

LCG的核心由一个线性同余方程定义：

> **Xₙ₊₁ ≡ (a · Xₙ + c) (mod m)**

其中：

- **`Xₙ`**: 当前状态(种子或上一个随机数)。

- **`a`**: 乘数 (Multiplier)。
 
- **`c`**: 增量 (Increment)。
   
- **`m`**: 模数 (Modulus)，通常是一个很大的整数，决定了序列的范围（`0` 到 `m-1`）。

整个生成器的安全性(或不可预测性)完全依赖于参数 **(a, c, m)** 和初始种子 **`X₀`** 的保密性!

---

##  第二步：典型参数与性质

LCG生成的随机数序列具有周期性。为了获得一个长周期（理想情况下达到 **`m`**），参数需要精心选择：

- **`c`** 和 **`m`** 互质。
- **`a - 1`** 可以被 `m` 的所有质因数整除。
- 如果 `m` 是4的倍数，那么 **`a - 1`** 也必须是4的倍数。

一个历史上著名且脆弱的例子是 **glibc的`rand()`** (某些版本)：

> **a = 1103515245, c = 12345, m = 2^31**

由于其参数完全公开，只要知道连续几个输出值，就能轻易破解整个序列。

---

##  第三步：攻击与破解

在CTF密码学题中，LCG的破解通常分为以下几种情况，核心是求解未知参数：

###  情况1：已知`a, c, m`，求种子`X₀`

如果参数已知，你只需要一个输出值 `X1`，就可以通过逆推得到种子：

> **X0 ≡ a⁻¹ * (X1 - c) mod m**

其中 `a⁻¹` 是 `a` 在模 `m` 下的乘法逆元。

###  情况2：未知`a, c`，但已知`m`和连续输出

这是经典场景。已知连续四个输出 `X0, X1, X2, X3` 和模数 `m`，我们可以恢复 `a` 和 `c`：

1.  计算 `a`:

> **a ≡ (X2 - X1) * (X1 - X0)⁻¹ mod m**

2.  计算 `c`:

> **c ≡ (X_1 - a * X_0) mod m**

###  情况3：连`m`也未知

需要更多的连续输出值（例如6个），利用数列差值构成的序列，其最大公约数很可能就是 `m`，然后再套用情况2的方法。

---

##  第四步：LCG的优缺点

###  优点

**实现极其简单**，计算速度快，占用内存小。

在不需要高安全性的场合（如模拟、游戏）仍有使用。

###  缺点（也是密码学上的致命弱点）

*  **可预测性**：正如破解方法所示，序列并非真正随机。
*  **序列相关性**：低位比特的随机性周期更短（例如，最低位可能只是0和1交替）。
*  **高维分布不均匀**：如果将连续生成的几个数作为高维空间中的点，这些点会落在少数几个超平面上（Marsaglia定理）。

因此，**LCG绝不能用于任何需要密码学安全随机数的场景**，如生成密钥。

---

##  小结

- LCG是一种简单高效的**伪随机数生成器(PRNG)**，但密码学上不安全。
- 其核心是递推公式：**Xₙ₊₁ ≡ (a · Xₙ + c) (mod m)**。
- 在CTF中，破解LCG的关键在于利用连续的输出值，通过解模运算方程来恢复未知参数 `(a, c, m, seed)`。

一个简单的Python实现示例：

```python
class LCG:
    def __init__(self, seed, a, c, m):
        self.state = seed
        self.a = a
        self.c = c
        self.m = m

    def next(self):
        self.state = (self.a * self.state + self.c) % self.m
        return self.state
```

记住，看到连续的、模某个大数的随机数，先想想是不是LCG！

over~

感谢阅读!

</div>