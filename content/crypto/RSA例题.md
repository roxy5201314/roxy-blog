---
title: "æ¥åšä¸€é“RSAå…¥é—¨é¢˜å§!"
excerpt: "ezRSA"
date: "2025-12-09"
slug: "rsa-example"
section: "crypto"
---

<div class="intro-article">

# **ç›¸å½“äºæˆ‘çš„é¢˜è§£**ğŸ˜‚ğŸ˜‚

å…ˆç»™å‡ºé¢˜ç›®:

```python
//cipher.py
from Crypto.Util.number import * 
from gmpy2 import * 
with open("/home/ctf/flag", "r") as f: 
flag = f.read().strip().encode() 
m = bytes_to_long(flag) 
p = getPrime(512) 
q = next_prime(p) 
n = p * q 
e = 0x10001 
d = inverse(e, (p-1) * (q-1)) 
c = pow(m, e, n) 
print(f"c = {c}") 
print(f"d = {d}") 
c = 2382475417612221029195991422974637682790907959505872057612789600021232022809557015773490645186824472471102983790148757867812357803783967352960757619002038826907060092309775753732723354584179093707192435729752294617650638277041714861100817616820264627123087547545127802637327100886413921708433926850797315065 
d = 25870330341587644557506269425904862005091761270098246437027336498404986684820747768161278804893693431118462970977749986507893638555530406810784167861241466417073720713120287069835276598399825459462715213456508074868393454518636408061277002175376013587646496781389777927884174769153760862313567065511810387073
```

## åˆ†æé¢˜ç›®é€»è¾‘:

1. æ³„éœ²äº†ç§é’¥æŒ‡æ•° d

åœ¨ RSA ä¸­ï¼Œæœ‰ï¼š

> edâ‰¡1(modÏ†(n))

å› æ­¤å¿…ç„¶å­˜åœ¨æ•´æ•° kï¼Œä½¿å¾—ï¼š

> edâˆ’1=kâ‹…Ï†(n)

è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ k = e*d - 1 æ¥æ„é€ æ‰€æœ‰å¯èƒ½çš„ Ï†(n)ã€‚

2. p å’Œ q æ˜¯**ç›¸é‚»ç´ æ•°**

æœ¬é¢˜ä¸­ï¼š

> q = next_prime(p)

å› æ­¤ï¼š

pã€q æä¸ºæ¥è¿‘

q - p = g å¾ˆå°ï¼ˆä¸€èˆ¬ < 1000ï¼‰

è¿™ä½¿å¾— Ï†(n) çš„å½¢å¼ï¼š

> Ï†(n)=(pâˆ’1)(qâˆ’1)

å¯ä»¥å±•å¼€æˆä¸€ä¸ªå…³äº p çš„äºŒæ¬¡æ–¹ç¨‹ï¼Œæšä¸¾ g å°±èƒ½æŠŠ p è§£å‡ºæ¥ã€‚

##  è§£é¢˜æ•´ä½“æ€è·¯

âœ” Step 1ï¼šæ ¹æ® d æ±‚å‡º Ï†(n) å€™é€‰

è®¡ç®—ï¼š

> k=edâˆ’1

å› ä¸ºï¼š

> k=tâ‹…Ï†(n)

æˆ‘ä»¬åªéœ€è¦æšä¸¾ k çš„ å°å› å­ tï¼š

> Ï†=k/t

å³å¯å¾—åˆ°æ‰€æœ‰ Ï†(n) çš„å¯èƒ½å€¼ã€‚

âœ” Step 2ï¼šåˆ©ç”¨ q = next_prime(p) æ±‚ p

å·²çŸ¥ï¼š

q = p + g   ï¼ˆg å¾ˆå°ï¼‰

Ï† = (p-1)(p+g-1)

å±•å¼€ï¼š

> ğ‘^2+(ğ‘”âˆ’2)ğ‘+(1-ğ‘”)âˆ’ğœ‘=0

è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†äºŒæ¬¡æ–¹ç¨‹ã€‚

å¯¹æ¯ä¸ª gï¼ˆ0~2000ï¼‰ï¼š

1.è§£æ–¹ç¨‹å¾—åˆ° p

2.åˆ¤æ–­ p æ˜¯å¦ä¸ºç´ æ•°

3.q æ˜¯å¦ç­‰äº next_prime(p)

4.æ˜¯å¦æ»¡è¶³ Ï† = (p-1)(q-1)

è‹¥å…¨éƒ¨ç¬¦åˆ => æˆåŠŸåˆ†è§£ nã€‚

âœ” Step 3ï¼šè§£å¯†å¯†æ–‡

å¾—åˆ° pã€q åï¼š

> n = p * q

> m = pow(c, d, n)

> flag = long_to_bytes(m)

å³å¯å¾—åˆ°æœ€ç»ˆ flag!ğŸ˜œğŸ˜œ

## æœ€ç»ˆè„šæœ¬â˜ºï¸

```python
//exploit.py
from Crypto.Util.number import *
from gmpy2 import is_prime, iroot, next_prime
#è§é¢˜ç›®
c = 2382475417612221029195991422974637682790907959505872057612...
d = 2587033034158764455750626942590486200509176127009824643...
e = 65537

k = e*d - 1

# æšä¸¾å°å› å­
for t in range(1, 20000):
    if k % t != 0:
        continue

    phi = k // t

    # æšä¸¾ g = q - p
    for g in range(1, 2000):
        # äºŒæ¬¡æ–¹ç¨‹: p^2 + (g-2)p + (1-g) - phi = 0
        a = 1
        b = g - 2
        c2 = (1 - g) - phi

        # æ±‚ Î”
        D = b*b - 4*a*c2
        if D < 0:
            continue

        r, ok = iroot(D, 2)
        if not ok:
            continue

        # æ±‚è§£ p
        p = (-b + r) // 2
        if p <= 0:
            continue

        if not is_prime(p):
            continue

        q = next_prime(p)
        if (p-1)*(q-1) != phi:
            continue

        print("[+] Found p =", p)
        print("[+] Found q =", q)

        n = p*q
        m = pow(c, d, n)
        print(long_to_bytes(m))
        exit()
```

å¾—åˆ°:

> XSWCTF{YOu_KnOW_H0w_To_f4CTOrIZe_PHl}

good!ğŸ˜ğŸ˜ğŸ˜

## è¡¥å……è§£æ³•:**Fermat åˆ†è§£**

å½“ï¼š

> qâˆ’p å¾ˆå°

å°±å¯ä»¥ç”¨ è´¹é©¬åˆ†è§£æ³•(Fermat åˆ†è§£)ï¼š

> n=a^2âˆ’b^2=(aâˆ’b)(a+b)

å…¶ä¸­ï¼š

> a=âŒˆsqrt(n)â€‹âŒ‰

ä¸ä¼šè£…latexæ’ä»¶ï¼Œè§è°…ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­

ä¸”:

> b^2=a^2âˆ’n

å¦‚æœï¼š

> b^2=k^2

åˆ™ï¼š

> b=k

å¹¶å¾—åˆ°ï¼š

> p=aâˆ’b,q=a+b

å®Œæˆåˆ†è§£ã€‚

å¦‚æœb^2ä¸æ˜¯å®Œå…¨å¹³æ–¹æ•°ï¼š

> aâ†a+1

å›åˆ° Step 2å¾ªç¯

**é€šå¸¸å¾ˆå¿«å°±èƒ½å¾—åˆ°ç»“æœ...**

å¯ä»¥è‡ªè¡Œæœç´¢èµ„æ–™...â˜ºï¸

ä»£ç å®ç°:

```python
exploit.py
import gmpy2

def fermat(n):
    a = gmpy2.isqrt(n)
    if a * a < n:
        a += 1

    while True:
        b2 = a * a - n
        b = gmpy2.isqrt(b2)
        if b * b == b2:
            return a - b, a + b
        a += 1
```

*that is end*â˜ºï¸

æ„Ÿè°¢é˜…è¯»!â˜ºï¸

</div>