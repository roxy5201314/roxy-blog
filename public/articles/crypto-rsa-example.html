<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>æ¥åšä¸€é“RSAå…¥é—¨é¢˜å§!</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
</head>
<body>
<div class="article-content" data-id="crypto-rsa-example">
<div class="intro-article">
<h1><strong>ç›¸å½“äºæˆ‘çš„é¢˜è§£</strong>ğŸ˜‚ğŸ˜‚</h1>
<p>å…ˆç»™å‡ºé¢˜ç›®:</p>
<pre><code class="language-python">
<pre class="hljs"><code class="language-python">
//cipher.py
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> * 
<span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> * 
<span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/home/ctf/flag&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f: 
flag = f.read().strip().encode() 
m = bytes_to_long(flag) 
p = getPrime(<span class="hljs-number">512</span>) 
q = next_prime(p) 
n = p * q 
e = <span class="hljs-number">0x10001</span> 
d = inverse(e, (p-<span class="hljs-number">1</span>) * (q-<span class="hljs-number">1</span>)) 
c = <span class="hljs-built_in">pow</span>(m, e, n) 
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;c = <span class="hljs-subst">{c}</span>&quot;</span>) 
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;d = <span class="hljs-subst">{d}</span>&quot;</span>) 
c = <span class="hljs-number">2382475417612221029195991422974637682790907959505872057612789600021232022809557015773490645186824472471102983790148757867812357803783967352960757619002038826907060092309775753732723354584179093707192435729752294617650638277041714861100817616820264627123087547545127802637327100886413921708433926850797315065</span> 
d = <span class="hljs-number">25870330341587644557506269425904862005091761270098246437027336498404986684820747768161278804893693431118462970977749986507893638555530406810784167861241466417073720713120287069835276598399825459462715213456508074868393454518636408061277002175376013587646496781389777927884174769153760862313567065511810387073</span>

</code></pre></code></pre>
<h2>åˆ†æé¢˜ç›®é€»è¾‘:</h2>
<ol>
<li>æ³„éœ²äº†ç§é’¥æŒ‡æ•° d</li>
</ol>
<p>åœ¨ RSA ä¸­ï¼Œæœ‰ï¼š</p>
<blockquote>
<p>edâ‰¡1(modÏ†(n))</p>
</blockquote>
<p>å› æ­¤å¿…ç„¶å­˜åœ¨æ•´æ•° kï¼Œä½¿å¾—ï¼š</p>
<blockquote>
<p>edâˆ’1=kâ‹…Ï†(n)</p>
</blockquote>
<p>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ k = e*d - 1 æ¥æ„é€ æ‰€æœ‰å¯èƒ½çš„ Ï†(n)ã€‚</p>
<ol start="2">
<li>p å’Œ q æ˜¯<strong>ç›¸é‚»ç´ æ•°</strong></li>
</ol>
<p>æœ¬é¢˜ä¸­ï¼š</p>
<blockquote>
<p>q = next_prime(p)</p>
</blockquote>
<p>å› æ­¤ï¼š</p>
<p>pã€q æä¸ºæ¥è¿‘</p>
<p>q - p = g å¾ˆå°ï¼ˆä¸€èˆ¬ &lt; 1000ï¼‰</p>
<p>è¿™ä½¿å¾— Ï†(n) çš„å½¢å¼ï¼š</p>
<blockquote>
<p>Ï†(n)=(pâˆ’1)(qâˆ’1)</p>
</blockquote>
<p>å¯ä»¥å±•å¼€æˆä¸€ä¸ªå…³äº p çš„äºŒæ¬¡æ–¹ç¨‹ï¼Œæšä¸¾ g å°±èƒ½æŠŠ p è§£å‡ºæ¥ã€‚</p>
<h2>è§£é¢˜æ•´ä½“æ€è·¯</h2>
<p>âœ” Step 1ï¼šæ ¹æ® d æ±‚å‡º Ï†(n) å€™é€‰</p>
<p>è®¡ç®—ï¼š</p>
<blockquote>
<p>k=edâˆ’1</p>
</blockquote>
<p>å› ä¸ºï¼š</p>
<blockquote>
<p>k=tâ‹…Ï†(n)</p>
</blockquote>
<p>æˆ‘ä»¬åªéœ€è¦æšä¸¾ k çš„ å°å› å­ tï¼š</p>
<blockquote>
<p>Ï†=k/t</p>
</blockquote>
<p>å³å¯å¾—åˆ°æ‰€æœ‰ Ï†(n) çš„å¯èƒ½å€¼ã€‚</p>
<p>âœ” Step 2ï¼šåˆ©ç”¨ q = next_prime(p) æ±‚ p</p>
<p>å·²çŸ¥ï¼š</p>
<p>q = p + g   ï¼ˆg å¾ˆå°ï¼‰</p>
<p>Ï† = (p-1)(p+g-1)</p>
<p>å±•å¼€ï¼š</p>
<blockquote>
<p>ğ‘^2+(ğ‘”âˆ’2)ğ‘+(1-ğ‘”)âˆ’ğœ‘=0</p>
</blockquote>
<p>è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†äºŒæ¬¡æ–¹ç¨‹ã€‚</p>
<p>å¯¹æ¯ä¸ª gï¼ˆ0~2000ï¼‰ï¼š</p>
<p>1.è§£æ–¹ç¨‹å¾—åˆ° p</p>
<p>2.åˆ¤æ–­ p æ˜¯å¦ä¸ºç´ æ•°</p>
<p>3.q æ˜¯å¦ç­‰äº next_prime(p)</p>
<p>4.æ˜¯å¦æ»¡è¶³ Ï† = (p-1)(q-1)</p>
<p>è‹¥å…¨éƒ¨ç¬¦åˆ =&gt; æˆåŠŸåˆ†è§£ nã€‚</p>
<p>âœ” Step 3ï¼šè§£å¯†å¯†æ–‡</p>
<p>å¾—åˆ° pã€q åï¼š</p>
<blockquote>
<p>n = p * q</p>
</blockquote>
<blockquote>
<p>m = pow(c, d, n)</p>
</blockquote>
<blockquote>
<p>flag = long_to_bytes(m)</p>
</blockquote>
<p>å³å¯å¾—åˆ°æœ€ç»ˆ flag!ğŸ˜œğŸ˜œ</p>
<h2>æœ€ç»ˆè„šæœ¬â˜ºï¸</h2>
<pre><code class="language-python">
<pre class="hljs"><code class="language-python">
//exploit.py
<span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *
<span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> is_prime, iroot, next_prime
<span class="hljs-comment">#è§é¢˜ç›®</span>
c = <span class="hljs-number">2382475417612221029195991422974637682790907959505872057612.</span>..
d = <span class="hljs-number">2587033034158764455750626942590486200509176127009824643.</span>..
e = <span class="hljs-number">65537</span>

k = e*d - <span class="hljs-number">1</span>

<span class="hljs-comment"># æšä¸¾å°å› å­</span>
<span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">20000</span>):
    <span class="hljs-keyword">if</span> k % t != <span class="hljs-number">0</span>:
        <span class="hljs-keyword">continue</span>

    phi = k // t

    <span class="hljs-comment"># æšä¸¾ g = q - p</span>
    <span class="hljs-keyword">for</span> g <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2000</span>):
        <span class="hljs-comment"># äºŒæ¬¡æ–¹ç¨‹: p^2 + (g-2)p + (1-g) - phi = 0</span>
        a = <span class="hljs-number">1</span>
        b = g - <span class="hljs-number">2</span>
        c2 = (<span class="hljs-number">1</span> - g) - phi

        <span class="hljs-comment"># æ±‚ Î”</span>
        D = b*b - <span class="hljs-number">4</span>*a*c2
        <span class="hljs-keyword">if</span> D &lt; <span class="hljs-number">0</span>:
            <span class="hljs-keyword">continue</span>

        r, ok = iroot(D, <span class="hljs-number">2</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> ok:
            <span class="hljs-keyword">continue</span>

        <span class="hljs-comment"># æ±‚è§£ p</span>
        p = (-b + r) // <span class="hljs-number">2</span>
        <span class="hljs-keyword">if</span> p &lt;= <span class="hljs-number">0</span>:
            <span class="hljs-keyword">continue</span>

        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> is_prime(p):
            <span class="hljs-keyword">continue</span>

        q = next_prime(p)
        <span class="hljs-keyword">if</span> (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>) != phi:
            <span class="hljs-keyword">continue</span>

        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Found p =&quot;</span>, p)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] Found q =&quot;</span>, q)

        n = p*q
        m = <span class="hljs-built_in">pow</span>(c, d, n)
        <span class="hljs-built_in">print</span>(long_to_bytes(m))
        exit()

</code></pre></code></pre>
<p>å¾—åˆ°:</p>
<blockquote>
<p>XSWCTF{YOu_KnOW_H0w_To_f4CTOrIZe_PHl}</p>
</blockquote>
<p>good!ğŸ˜ğŸ˜ğŸ˜</p>
<h2>è¡¥å……è§£æ³•:<strong>Fermat åˆ†è§£</strong></h2>
<p>å½“ï¼š</p>
<blockquote>
<p>qâˆ’p å¾ˆå°</p>
</blockquote>
<p>å°±å¯ä»¥ç”¨ è´¹é©¬åˆ†è§£æ³•(Fermat åˆ†è§£)ï¼š</p>
<blockquote>
<p>n=a^2âˆ’b^2=(aâˆ’b)(a+b)</p>
</blockquote>
<p>å…¶ä¸­ï¼š</p>
<blockquote>
<p>a=âŒˆsqrt(n)â€‹âŒ‰</p>
</blockquote>
<p>ä¸ä¼šè£…latexæ’ä»¶ï¼Œè§è°…ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­</p>
<p>ä¸”:</p>
<blockquote>
<p>b^2=a^2âˆ’n</p>
</blockquote>
<p>å¦‚æœï¼š</p>
<blockquote>
<p>b^2=k^2</p>
</blockquote>
<p>åˆ™ï¼š</p>
<blockquote>
<p>b=k</p>
</blockquote>
<p>å¹¶å¾—åˆ°ï¼š</p>
<blockquote>
<p>p=aâˆ’b,q=a+b</p>
</blockquote>
<p>å®Œæˆåˆ†è§£ã€‚</p>
<p>å¦‚æœb^2ä¸æ˜¯å®Œå…¨å¹³æ–¹æ•°ï¼š</p>
<blockquote>
<p>aâ†a+1</p>
</blockquote>
<p>å›åˆ° Step 2å¾ªç¯</p>
<p><strong>é€šå¸¸å¾ˆå¿«å°±èƒ½å¾—åˆ°ç»“æœâ€¦</strong></p>
<p>å¯ä»¥è‡ªè¡Œæœç´¢èµ„æ–™â€¦â˜ºï¸</p>
<p>ä»£ç å®ç°:</p>
<pre><code class="language-python">
<pre class="hljs"><code class="language-python">
exploit.py
<span class="hljs-keyword">import</span> gmpy2

<span class="hljs-keyword">def</span> <span class="hljs-title function_">fermat</span>(<span class="hljs-params">n</span>):
    a = gmpy2.isqrt(n)
    <span class="hljs-keyword">if</span> a * a &lt; n:
        a += <span class="hljs-number">1</span>

    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        b2 = a * a - n
        b = gmpy2.isqrt(b2)
        <span class="hljs-keyword">if</span> b * b == b2:
            <span class="hljs-keyword">return</span> a - b, a + b
        a += <span class="hljs-number">1</span>

</code></pre></code></pre>
<p><em>that is end</em>â˜ºï¸</p>
<p>æ„Ÿè°¢é˜…è¯»!â˜ºï¸</p>
</div>
</div>
</body>
</html>